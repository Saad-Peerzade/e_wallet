<!DOCTYPE html>
<html>
<head>
    <title>Withdraw Oranges</title>
</head>
<body>
    <h2>Withdraw Oranges üçä</h2>

    <form id="withdrawForm">
        <label>Amount:</label>
        <input type="number" name="amount" min="1" required><br>
        <button type="submit">Withdraw</button>
    </form>
    
    <br>
    <!-- Generate and Remove QR Code Buttons -->
    <button id="generateQrBtn">Generate QR Code</button>
    <button id="removeQrBtn" style="display:none;">Remove QR Code</button>
    
    <!-- QR Code Display Area -->
    <div id="qrCodeContainer"></div>

    <a href="{{ url_for('dashboard') }}">Back to Dashboard</a>

    <script>
        document.getElementById("withdrawForm").addEventListener("submit", function(event) {
            event.preventDefault(); // ‚úÖ Prevent page reload

            let formData = new FormData(this);

            fetch("{{ url_for('withdraw') }}", {
                method: "POST",
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === "success") {
                    alert("‚úÖ " + data.message);
                } else {
                    alert("‚ùå " + data.message);
                }
            })
            .catch(error => {
                console.error("Error:", error);
                alert("‚ùå Something went wrong!");
            });
        });

        // ‚úÖ QR Code Generation Logic
        document.getElementById("generateQrBtn").addEventListener("click", function() {
            fetch("{{ url_for('generate_qr') }}")
            .then(response => response.json())
            .then(data => {
                if (data.qr_code) {
                    const qrCodeContainer = document.getElementById("qrCodeContainer");
                    qrCodeContainer.innerHTML = `<img src="${data.qr_code}" alt="QR Code">`;
                    document.getElementById("removeQrBtn").style.display = "inline-block";
                } else {
                    alert("‚ùå Failed to generate QR code.");
                }
            })
            .catch(error => console.error("Error:", error));
        });

        // ‚úÖ Remove QR Code
        document.getElementById("removeQrBtn").addEventListener("click", function() {
            document.getElementById("qrCodeContainer").innerHTML = "";
            this.style.display = "none";
        });
    </script>
</body>
</html>
